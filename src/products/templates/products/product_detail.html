{% extends 'base.html' %}
{% load static %}

<script>
{% block jquery %}
    function setPrice(){
        var price = $(".variation_select option:selected").attr("data-price")
        var sale_price = $(".variation_select option:selected").attr("data-sale-price")
        if (sale_price != "" && sale_price != "None" && sale_price != null ) {
            $("#price").html("<h3>" + sale_price + " <small class='og-price'>" + price  + "</small></h3>");
        } else {
            $("#price").html(price);
        }
}
    setPrice()
    $(".variation_select").change(function(){
        setPrice()
    })

    $("#submit-btn").click(function(event){
    event.preventDefault();
    var formData = $("#add-form").serialize();
    console.log('form data', formData);
    $.ajax({
        type: "GET", // "POST"
        url: "{% url 'cart' %}",
        data: formData,
        success: function(data) {
            showFlashMessage(data.flash_message)
            // updateCartItemCount();
        },
        error: function(response, error) {
            // console.log(response)
            // console.log(error)
            $("#add-form").submit()
        }
    })

})
{% endblock %}
</script>

{% block content %}

<div class="container">
<div class="row main-content">
    <div class="col-sm-8">
        <h2> {{ object.title }}</h2>
        {% if object.productimage_set.count > 0 %}
        {% for img in object.productimage_set.all %}
            <img class="img-responsive" src="{{ img.image.url }}">
        {% endfor %}

        {% endif %}
        <p class="lead">{{ object.description }}</p>
    </div>
<!--     PRODUCT SIDE BAR -->
    <div class="col-sm-4">
        <form id='add-form' method='GET' action="{% url 'cart' %}">
            <p id='jquery-message' class='lead'></p>
            {% if object.variation_set.count > 1 %}
                <h3 id='price'>${{ object.variation_set.first.price }}</h3>
                <select name='item' class='form-control form-control-lg variation_select'>
                    {% for vari_obj in object.variation_set.all %}
                        <option  data-sale-price="{{ vari_obj.sale_price }}" data-price="{{ vari_obj.price }}" value="{{ vari_obj.id }}">{{ vari_obj }}</option>
                    {% endfor %}
                </select>
            {% else %}
                <input type="hidden" name='item' value='{{ object.variation_set.first.id }}' />
                    <h3 id='price'>
                    {% if object.variation_set.first.sale_price %}
                        {{ object.variation_set.first.sale_price  }}
                        <small class='og-price'>{{ object.variation_set.first.price }}</small>
                    {% else %}
                        {{ object.variation_set.first.price }}
                    {% endif %}
                    </h3>
            {% endif %}
            <br />
            <input class='form-control' type='number' name='qty' value='1' />
            <input id='submit-btn' type='submit' value='Add to Cart' class='btn btn-default' />
        </form>
    </div>
</div>
</div>
</div>
<hr />
<div class="container">
<div class="row text-center">
    <div class="col-lg-6">
    <h3 >Related Products</h3>
</div>
</div>
    {% include 'products/related_products.html' with related=related %}
</div>
</div>
{% endblock %}
